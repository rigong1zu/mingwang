import{b5 as L,b6 as z,u as v,d as B,r as g,b$ as J,m as U,j as e,J as K,K as X,O as Q,Q as Y,B as d,b9 as Z,n as M,X as i,I as x,c0 as ee,c1 as se,b2 as j,bu as f,bs as w,bK as ae,bL as ne,bM as te,bN as le,bP as $,bZ as k,bg as E,c2 as q,bh as V,bi as I,c3 as O,bk as A,bl as W,b_ as R,b as ie,c4 as re,c5 as F,bt as oe,L as ce,Y as me,bD as _,c6 as de,bJ as G}from"./index.b12a37b1.js";import{P as N,a as l,b as C,c as S,d as P}from"./Paragraph.b0fc65ff.js";import{M as b}from"./multi-combobox.7321a305.js";import{a as he}from"./hook.04a71eda.js";import{S as ue}from"./save.418a132c.js";import{S as D}from"./settings-2.e91964a4.js";async function xe(){try{const n=(await L.get("/admin/config/view")).data;return n.status&&n.data&&(n.data.mail.white_list.white_list=n.data.mail.white_list.white_list||H,n.data.search.engines=n.data.search.engines||[],n.data.search.crop_len=n.data.search.crop_len&&n.data.search.crop_len>0?n.data.search.crop_len:1e3),n}catch(a){return{status:!1,error:z(a)}}}async function pe(a){try{return(await L.post("/admin/config/update",a)).data}catch(n){return{status:!1,error:z(n)}}}async function je(a){try{return(await L.post("/admin/user/root",{password:a})).data}catch(n){return{status:!1,error:z(n)}}}async function ge(a){try{return(await L.get(`/admin/config/test/search?query=${encodeURIComponent(a)}`)).data}catch(n){return{status:!1,error:z(n),result:""}}}const H=["gmail.com","outlook.com","yahoo.com","hotmail.com","foxmail.com","icloud.com","qq.com","163.com","126.com"],ye={general:{logo:"",title:"",backend:"",docs:"",file:"",pwa_manifest:"",debug_mode:!1},site:{close_register:!1,close_relay:!1,relay_plan:!1,quota:0,buy_link:"",announcement:"",contact:"",footer:"",auth_footer:!1},mail:{protocol:!1,host:"",port:465,username:"",password:"",from:"",white_list:{enabled:!1,custom:"",white_list:[]}},search:{endpoint:"",crop:!1,crop_len:1e3,engines:[],image_proxy:!1,safe_search:0},common:{article:[],generation:[],cache:[],expire:3600,size:1,image_store:!1}};function fe(){const{t:a}=v(),{toast:n}=B(),[r,s]=g.useState(!1),[t,h]=g.useState(""),[u,o]=g.useState(""),y=async()=>{const p=await je(t);_(n,a,p,!0),p.status&&(h(""),o(""),s(!1),setTimeout(()=>{window.location.reload()},1e3))};return e.jsxs(E,{open:r,onOpenChange:s,children:[e.jsx(q,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:a("admin.system.updateRoot")})}),e.jsxs(V,{children:[e.jsxs(I,{children:[e.jsx(O,{children:a("admin.system.updateRoot")}),e.jsxs(A,{children:[e.jsx("div",{className:"mb-4 select-none",children:a("admin.system.updateRootTip")}),e.jsx(x,{className:"mb-2",type:"password",placeholder:a("admin.system.updateRootPlaceholder"),value:t,onChange:p=>h(p.target.value)}),e.jsx(x,{type:"password",placeholder:a("admin.system.updateRootRepeatPlaceholder"),value:u,onChange:p=>o(p.target.value)})]})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"outline",onClick:()=>{h(""),o(""),s(!1)},children:a("admin.cancel")}),e.jsx(d,{variant:"default",loading:!0,onClick:y,disabled:t.trim().length===0||t.trim()!==u.trim(),children:a("admin.confirm")})]})]})]})}function ve({data:a,dispatch:n,onChange:r}){const{t:s}=v();return e.jsxs(N,{title:s("admin.system.general"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.title")}),e.jsx(x,{value:a.title,onChange:t=>n({type:"update:general.title",value:t.target.value}),placeholder:s("admin.system.titleTip")})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.docs")}),e.jsx(x,{value:a.docs,onChange:t=>n({type:"update:general.docs",value:t.target.value}),placeholder:s("admin.system.docsTip")})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.logo")}),e.jsx(x,{value:a.logo,onChange:t=>n({type:"update:general.logo",value:t.target.value}),placeholder:s("admin.system.logoTip",{logo:`${window.location.protocol}//${window.location.host}/favicon.ico`})})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.backend")}),e.jsx(x,{value:a.backend,onChange:t=>n({type:"update:general.backend",value:t.target.value}),placeholder:s("admin.system.backendPlaceholder")})]}),e.jsx(C,{border:!0,children:s("admin.system.backendTip",{backend:`${window.location.protocol}//${window.location.host}/api`})}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.file")}),e.jsx(x,{value:a.file,onChange:t=>n({type:"update:general.file",value:t.target.value}),placeholder:s("admin.system.filePlaceholder")})]}),e.jsx(C,{border:!0,children:s("admin.system.fileTip")}),e.jsxs(l,{children:[e.jsx(i,{children:"PWA Manifest"}),e.jsx(ee,{value:a.pwa_manifest??"",onChange:t=>n({type:"update:general.pwa_manifest",value:t}),children:e.jsxs(d,{variant:"outline",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),s("edit")]})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[s("admin.system.debugMode"),e.jsx(j,{className:"inline-block",content:s("admin.system.debugModeTip")})]}),e.jsx(f,{checked:a.debug_mode,onCheckedChange:t=>{n({type:"update:general.debug_mode",value:t})}})]}),e.jsx(S,{}),e.jsxs(P,{children:[e.jsx("div",{className:"grow"}),e.jsx(fe,{}),e.jsx(d,{size:"sm",loading:!0,onClick:async()=>await r(),children:s("admin.system.save")})]})]})}function we({data:a,dispatch:n,onChange:r}){const{t:s}=v(),[t,h]=g.useState(""),[u,o]=g.useState(!1),y=g.useMemo(()=>a.host.length>0&&a.port>0&&a.port<65535&&a.username.length>0&&a.password.length>0&&a.from.length>0,[a]),p=async()=>{if(!t.trim())return;await r(!1);const c=await de(t);_(G,s,c,!0),c.status&&o(!1)},T=g.useMemo(()=>{const c=a.white_list.custom.split(",").map(m=>m.trim()).filter(m=>m.length>0);return[...H,...c]},[a]);return e.jsxs(N,{title:s("admin.system.mail"),configParagraph:!0,isCollapsed:!0,children:[!y&&e.jsx(C,{border:!0,children:s("admin.system.mailConfNotValid")}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailHost")]}),e.jsx(x,{value:a.host,onChange:c=>n({type:"update:mail.host",value:c.target.value}),placeholder:"smtp.qcloudmail.com"})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailProtocol")]}),e.jsxs(ae,{value:a.protocol?"true":"false",onValueChange:c=>{n({type:"update:mail.protocol",value:c==="true"})},children:[e.jsx(ne,{className:"select",children:e.jsx(te,{placeholder:a.protocol?s("admin.system.mailProtocolTLS"):s("admin.system.mailProtocolSSL")})}),e.jsxs(le,{children:[e.jsx($,{value:"true",children:"TLS"}),e.jsx($,{value:"false",children:"SSL"})]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailPort")]}),e.jsx(k,{value:a.port,onValueChange:c=>n({type:"update:mail.port",value:c}),placeholder:"465",min:0,max:65535})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailUser")]}),e.jsx(x,{value:a.username,onChange:c=>n({type:"update:mail.username",value:c.target.value}),className:M("transition-all duration-300"),placeholder:s("admin.system.mailUser")})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailPass")]}),e.jsx(x,{value:a.password,onChange:c=>n({type:"update:mail.password",value:c.target.value}),placeholder:s("admin.system.mailPass")})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(w,{})," ",s("admin.system.mailFrom")]}),e.jsx(x,{value:a.from,onChange:c=>n({type:"update:mail.from",value:c.target.value}),placeholder:`${a.username}@${location.hostname}`,className:M("transition-all duration-300")})]}),e.jsx(S,{}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.mailEnableWhitelist")}),e.jsx(f,{checked:a.white_list.enabled,onCheckedChange:c=>{n({type:"update:mail.white_list.enabled",value:c})}})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.mailWhitelist")}),e.jsx(b,{value:a.white_list.white_list,list:T,disabled:!a.white_list.enabled,onChange:c=>{n({type:"update:mail.white_list.white_list",value:c})},placeholder:s("admin.system.mailWhitelistSelected",{length:a.white_list.white_list.length}),searchPlaceholder:s("admin.system.mailWhitelistSearchPlaceholder")})]}),e.jsx(x,{className:"mb-2",value:a.white_list.custom,onChange:c=>n({type:"update:mail.white_list.custom",value:c.target.value}),disabled:!a.white_list.enabled,placeholder:s("admin.system.customWhitelistPlaceholder")}),e.jsxs(P,{children:[e.jsx("div",{className:"grow"}),e.jsxs(E,{open:u,onOpenChange:o,children:[e.jsx(q,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:s("admin.system.test")})}),e.jsxs(V,{children:[e.jsxs(I,{children:[e.jsx(O,{children:s("admin.system.test")}),e.jsx(A,{className:"pt-2",children:e.jsx(x,{placeholder:s("auth.email-placeholder"),value:t,onChange:c=>h(c.target.value)})})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"outline",onClick:()=>{h(""),o(!1)},children:s("admin.cancel")}),e.jsx(d,{variant:"default",loading:!0,onClick:p,children:s("admin.confirm")})]})]})]}),e.jsx(d,{size:"sm",loading:!0,onClick:async()=>await r(),children:s("admin.system.save")})]})]})}function Ce({data:a,dispatch:n,onChange:r}){const{t:s}=v();return e.jsxs(N,{title:s("admin.system.site"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsxs(i,{children:[s("admin.system.closeRegistration"),e.jsx(j,{className:"inline-block",content:s("admin.system.closeRegistrationTip")})]}),e.jsx(f,{checked:a.close_register,onCheckedChange:t=>{n({type:"update:site.close_register",value:t})}})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[s("admin.system.closeRelay"),e.jsx(j,{className:"inline-block",content:s("admin.system.closeRelayTip")})]}),e.jsx(f,{checked:a.close_relay,onCheckedChange:t=>{n({type:"update:site.close_relay",value:t})}})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[s("admin.system.relayPlan"),e.jsx(j,{className:"inline-block",content:s("admin.system.relayPlanTip")})]}),e.jsx(f,{checked:a.relay_plan,onCheckedChange:t=>{n({type:"update:site.relay_plan",value:t})}})]}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[s("admin.system.quota"),e.jsx(j,{content:s("admin.system.quotaTip")})]}),e.jsx(k,{value:a.quota,onValueChange:t=>n({type:"update:site.quota",value:t}),placeholder:"5",min:0})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.buyLink")}),e.jsx(x,{value:a.buy_link,onChange:t=>n({type:"update:site.buy_link",value:t.target.value}),placeholder:s("admin.system.buyLinkPlaceholder")})]}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(i,{children:s("admin.system.announcement")}),e.jsx(R,{value:a.announcement,rows:12,onChange:t=>n({type:"update:site.announcement",value:t.target.value}),placeholder:s("admin.system.announcementPlaceholder")})]}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(i,{children:s("admin.system.contact")}),e.jsx(R,{value:a.contact,rows:6,onChange:t=>n({type:"update:site.contact",value:t.target.value}),placeholder:s("admin.system.contactPlaceholder")})]}),e.jsx(S,{}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(i,{children:s("admin.system.footer")}),e.jsx(R,{rows:6,value:a.footer,onChange:t=>n({type:"update:site.footer",value:t.target.value}),placeholder:s("admin.system.footerPlaceholder")})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.authFooter")}),e.jsx(f,{checked:a.auth_footer,onCheckedChange:t=>{n({type:"update:site.auth_footer",value:t})}})]}),e.jsxs(P,{children:[e.jsx("div",{className:"grow"}),e.jsx(d,{size:"sm",loading:!0,onClick:async()=>await r(),children:s("admin.system.save")})]})]})}function be({form:a,data:n,dispatch:r,onChange:s}){const{t}=v(),{channelModels:h}=he(),u=ie(re);return e.jsxs(N,{title:t("admin.system.common"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[t("admin.system.image_store"),e.jsx(j,{content:t("admin.system.image_storeTip")})]}),e.jsx(f,{checked:n.image_store,onCheckedChange:o=>{r({type:"update:common.image_store",value:o})}})]}),n.image_store&&a.general.backend.length===0&&e.jsx(C,{border:!0,children:t("admin.system.image_storeNoBackend")}),e.jsx(S,{}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[t("admin.system.cache"),e.jsx(j,{content:t("admin.system.cacheTip")})]}),e.jsx(b,{value:n.cache,onChange:o=>{r({type:"update:common.cache",value:o})},list:h,placeholder:t("admin.system.cachePlaceholder",{length:(n.cache??[]).length})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[t("admin.system.cacheExpired"),e.jsx(j,{className:"inline-block",content:t("admin.system.cacheExpiredTip")})]}),e.jsx(k,{value:n.expire,onValueChange:o=>r({type:"update:common.expire",value:o}),min:0})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[t("admin.system.cacheSize"),e.jsx(j,{className:"inline-block",content:t("admin.system.cacheSizeTip")})]}),e.jsx(k,{value:n.size,onValueChange:o=>r({type:"update:common.size",value:o}),min:0})]}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 ml-auto",children:[e.jsxs(d,{variant:"outline",onClick:()=>r({type:"update:common.cache",value:[]}),children:[e.jsx(D,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),t("admin.system.cacheNone")]}),e.jsxs(d,{variant:"outline",onClick:()=>r({type:"update:common.cache",value:u.filter(o=>o.free).map(o=>o.id)}),children:[e.jsx(D,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),t("admin.system.cacheFree")]}),e.jsxs(d,{variant:"outline",onClick:()=>r({type:"update:common.cache",value:h}),children:[e.jsx(D,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),t("admin.system.cacheAll")]})]})}),e.jsx(S,{}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[t("admin.system.article"),e.jsx(j,{content:t("admin.system.articleTip")})]}),e.jsx(b,{value:n.article,onChange:o=>{r({type:"update:common.article",value:o})},list:F,listTranslate:"admin.channels.groups",placeholder:t("admin.system.groupPlaceholder",{length:(n.article??[]).length})})]}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[t("admin.system.generate"),e.jsx(j,{content:t("admin.system.generateTip")})]}),e.jsx(b,{value:n.generation,onChange:o=>{r({type:"update:common.generation",value:o})},list:F,listTranslate:"admin.channels.groups",placeholder:t("admin.system.groupPlaceholder",{length:(n.generation??[]).length})})]}),e.jsxs(P,{children:[e.jsx("div",{className:"grow"}),e.jsx(d,{size:"sm",loading:!0,onClick:async()=>await s(),children:t("admin.system.save")})]})]})}function ke({data:a,dispatch:n,onChange:r}){const{t:s}=v(),[t,h]=g.useState(""),[u,o]=g.useState(!1),[y,p]=g.useState(""),[T,c]=g.useState(!1);return e.jsxs(N,{title:s("admin.system.search"),configParagraph:!0,isCollapsed:!0,children:[e.jsx(C,{border:!0,children:s("admin.system.searchTip")}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.searchEndpoint")}),e.jsx(x,{value:a.endpoint,onChange:m=>n({type:"update:search.endpoint",value:m.target.value}),placeholder:s("admin.system.searchPlaceholder")})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.searchEngines")}),e.jsx(b,{value:a.engines,onChange:m=>{n({type:"update:search.engines",value:m})},list:["google","bing","duckduckgo","qwant","brave","mojeek","arxiv","crossref","youtube","bilibili","presearch","yahoo","wiby","seznam","goo","naver","wikidata","wikipedia","wikimini","wikibooks","wikiquote","wikisource","wikispecies","wikiversity","wikivoyage","ask","currency","yep","yacy","genius","github","gitlab","gitea.com","bitbucket","codeberg","mdn"],placeholder:s("admin.system.searchEnginesPlaceholder",{length:(a.engines||[]).length}),searchPlaceholder:s("admin.system.searchEnginesSearchPlaceholder")})]}),a.engines.length===0&&e.jsx(C,{border:!0,children:s("admin.system.searchEnginesEmptyTip")}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[s("admin.system.searchImageProxy"),e.jsx(j,{content:s("admin.system.searchImageProxyTip")})]}),e.jsx(f,{checked:a.image_proxy,onCheckedChange:m=>{n({type:"update:search.image_proxy",value:m})}})]}),e.jsxs(l,{children:[e.jsxs(i,{className:"flex flex-row items-center",children:[s("admin.system.searchCrop"),e.jsx(j,{content:s("admin.system.searchCropTip")})]}),e.jsx(f,{checked:a.crop,onCheckedChange:m=>{n({type:"update:search.crop",value:m})}})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.searchCropLen")}),e.jsx(k,{value:a.crop_len,onValueChange:m=>n({type:"update:search.crop_len",value:m}),min:1,disabled:!a.crop})]}),e.jsxs(l,{children:[e.jsx(i,{children:s("admin.system.searchSafeSearch")}),e.jsx(oe,{value:["none","moderation","strict"][a.safe_search]||"none",onChange:m=>{n({type:"update:search.safe_search",value:["none","moderation","strict"].indexOf(m)})},list:["none","moderation","strict"],listTranslated:"admin.system.searchSafeSearchModes",hideSearchBar:!0})]}),e.jsxs(P,{children:[e.jsx("div",{className:"grow"}),e.jsxs(E,{open:u,onOpenChange:o,children:[e.jsx(q,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:s("admin.system.searchTest")})}),e.jsxs(V,{children:[e.jsxs(I,{children:[e.jsx(O,{children:s("admin.system.searchTest")}),e.jsx(R,{placeholder:s("admin.system.searchTestTip"),value:t,onChange:m=>h(m.target.value)}),(T||y)&&e.jsx("div",{className:"mt-2 border rounded-md p-4 flex items-center justify-center flex-col",children:T?e.jsx(ce,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm mb-1",children:"SearXNG Result"}),e.jsx(me,{value:y,rows:5,readOnly:!0})]})})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"outline",onClick:()=>{h(""),o(!1)},children:s("admin.cancel")}),e.jsx(d,{variant:"default",loading:!0,onClick:async()=>{await r(),p(""),c(!0);const m=await ge(t);m.status&&p(m.result),_(G,s,m,!0),c(!1)},children:s("admin.confirm")})]})]})]}),e.jsx(d,{size:"sm",loading:!0,onClick:async()=>await r(),children:s("admin.system.save")})]})]})}function Le(){const{t:a}=v(),{toast:n}=B(),[r,s]=g.useReducer(J(),ye),[t,h]=g.useState(!1),u=async y=>{const p=await pe(r);y!==!1&&_(n,a,p,!0)},o=async()=>{h(!0);const y=await xe();h(!1),_(n,a,y),y.status&&s({type:"set",value:y.data})};return U(o,[]),e.jsx("div",{className:"system",children:e.jsxs(K,{className:"admin-card system-card",children:[e.jsx(X,{className:"select-none",children:e.jsx(Q,{children:a("admin.settings")})}),e.jsxs(Y,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"system-actions flex flex-row",children:[e.jsx("div",{className:"grow"}),e.jsx(d,{size:"icon",variant:"outline",loading:!0,className:"mr-2",onClick:async()=>await o(),children:e.jsx(Z,{className:M(t&&"animate-spin","h-4 w-4")})}),e.jsx(d,{size:"icon",loading:!0,onClick:async()=>await u(),children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsx(ve,{form:r,data:r.general,dispatch:s,onChange:u}),e.jsx(Ce,{form:r,data:r.site,dispatch:s,onChange:u}),e.jsx(we,{form:r,data:r.mail,dispatch:s,onChange:u}),e.jsx(ke,{form:r,data:r.search,dispatch:s,onChange:u}),e.jsx(be,{form:r,data:r.common,dispatch:s,onChange:u})]})]})})}export{Le as default};
